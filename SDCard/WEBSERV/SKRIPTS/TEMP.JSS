var gl_labeldata=null;var gl_temperature=null;var gl_diagraminterval;var gl_dataarray=null;var gl_label=null;var gl_dataarray_smoothed=null;function RedrawStats(){Getgl_labels();GetTemp();gl_diagraminterval=setInterval("drawDiagram()",500)}function Getgl_labels(){var a=new XMLHttpRequest();a.onreadystatechange=function(){if(this.readyState==4&&this.status==200){gl_labeldata=a.responseText}};a.open("GET","../meassure/labels.txt",true);a.send()}function GetTemp(){var a=new XMLHttpRequest();a.onreadystatechange=function(){if(this.readyState==4&&this.status==200){gl_temperature=a.responseText}};a.open("GET","../meassure/temp.txt",true);a.send()}function drawDiagram(){if((gl_labeldata!=null)&&(gl_temperature!=null)){gl_dataarray=gl_temperature.split(",");gl_label=gl_labeldata.split(",");gl_dataarray_smoothed=Array(gl_dataarray.length);gl_dataarray.pop();gl_label.pop();gl_dataarray_smoothed.pop();var d=gl_dataarray.length;while(d--){gl_dataarray_smoothed[d]=gl_dataarray[d]}var a=0;while(a<gl_dataarray.length){a++;if((a+1)<gl_dataarray.length){gl_dataarray_smoothed[a]=parseFloat(gl_dataarray_smoothed[a-1])+(0.01*(parseFloat(gl_dataarray[a])-parseFloat(gl_dataarray_smoothed[a-1])));gl_dataarray_smoothed[a]=parseFloat(gl_dataarray_smoothed[a]).toFixed(4)}}var e=Math.min.apply(Math,gl_dataarray);gl_diagraminterval=clearInterval(gl_diagraminterval);var b=document.getElementById("TempChart").getContext("2d");var c=new Chart(b,{type:"line",data:{labels:gl_label,datasets:[{fill:false,label:"Temperatur in °C",borderColor:"rgba(128,0,0, .2)",backgroundColor:"rgba(128,0,0, .2)",data:gl_dataarray,borderWidth:1,pointRadius:0,pointHoverRadius:0,lineTension:0},{fill:false,label:"",borderColor:"rgba(0,0,0, 1)",backgroundColor:"rgba(0,0,0, 1)",data:gl_dataarray_smoothed,borderWidth:1,pointRadius:0,pointHoverRadius:0,lineTension:0}]},options:{legend:{display:false},scales:{yAxes:[{ticks:{min:e.toFixed(0)-1,stepSize:0.5}}]}}})}}function CSV_Export(){var e="Uhrzeit,Messwert,Mittelwert\r\n";for(var d=0;d<gl_dataarray.length;d++){e+=gl_label[d]+","+gl_dataarray[d]+","+gl_dataarray_smoothed[d]+"\r\n"}var c=new Blob([e],{type:"text/csv;charset=utf-8;"});if(window.navigator.msSaveOrOpenBlob){window.navigator.msSaveBlob(c,"TempChart.csv")}else{var b=window.document.createElement("a");b.href=window.URL.createObjectURL(c,{type:"text/plain"});b.download="Export.csv";document.body.appendChild(b);b.click();document.body.removeChild(b)}};