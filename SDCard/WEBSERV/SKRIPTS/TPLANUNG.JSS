var gl_Mousemove=[],gl_Cursorarray=[],gl_Selected_Cursor=0,gl_Selected_Channel=0,gl_Channel_Colors=new Array("green","blue","orange","Sienna","purple","gray"),gl_Cursor_Mouse_X_Offset=0,gl_Cursor_Mouse_Y_Offset=0;function Simulation_ReInit(){var e=new XMLHttpRequest;confirm("Simulation neustarten?")&&(e.open("POST","../sites/planung.htm",!0),e.send("WeatherInit=1"))}function Save_Day(e){var r=new XMLHttpRequest,n=["mon.txt","tue.txt","wed.txt","thu.txt","fri.txt","sat.txt","sun.txt"],t="";if(confirm(unescape("%C4nderungen%20%FCbernehmen%3F"))){for(var l=0;l<gl_Cursorarray.length;l++)t+=gl_Cursorarray[l].x+","+gl_Cursorarray[l].percent.toFixed(2)+","+gl_Cursorarray[l].channel+",\r\n";r.open("POST","../planning/"+n[e],!0),r.send(n[e]+"="+t)}}function Weekday_Load(e){confirm("Wochentag laden?")&&Load_Day(e)}function Copy_Day(){for(var e=["Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag","Sonntag"],r=prompt(unescape("Ziel%20Wochentag%20eingeben","")),n=0;n<7;n++)if(0==r.localeCompare(e[n]))return void Save_Day(n);alert("Wochentag nicht gefunden!")}function Channel_Copy(e){var r=prompt(unescape("Zielkanal%20eingeben",""));if(null!=r&&"-1"<r&&r<"6"){for(var n=gl_Cursorarray.length-1;0<=n;n--)gl_Cursorarray[n].channel==r&&gl_Cursorarray.splice(n,1);var t=gl_Cursorarray.length;for(n=0;n<t;n++)gl_Cursorarray[n].channel==e&&gl_Cursorarray.push({x:gl_Cursorarray[n].x,percent:gl_Cursorarray[n].percent,channel:r})}}function Load_Day(e){var r,n=new XMLHttpRequest;gl_Cursorarray=[];n.open("GET","../planning/"+["mon.txt","tue.txt","wed.txt","thu.txt","fri.txt","sat.txt","sun.txt"][e],!0),n.send(),n.onreadystatechange=function(){4==this.readyState&&200==this.status&&(document.getElementById("Channel_Select").value=gl_Selected_Channel,r=this.responseText,gl_Day=new Draw_Day(r),gl_Day.Init(),Channel_Change(),Animationloop())}}function Draw_Day(e){var l=50,o=15,t=720,a=400,c=document.getElementById("Planningwindow");c.width=845,c.height=430;var u=c.getContext("2d");if(""!=e){var r=[];(r=e.split(",")).pop();for(var n=0,s=0;n<r.length;n+=3,s++)gl_Cursorarray[s]={x:Number(r[n+0]),percent:Number(r[n+1]),channel:r[n+2]}}this.Init=function(){document.getElementById("Check0").checked=!0,document.getElementById("Check1").checked=!0,document.getElementById("Check2").checked=!0,document.getElementById("Check3").checked=!0,document.getElementById("Check4").checked=!0,document.getElementById("Check5").checked=!0,c.addEventListener("mousemove",function(e){var r,n;if(rect=c.getBoundingClientRect(),r=e.clientX-rect.left,n=e.clientY-rect.top,!(r<49||769<r||n<o||414<n)){if(r<l&&(r=l),1==gl_Mousemove.clicked){for(var t=gl_Selected_Cursor-1;0<=t;t--)if(gl_Cursorarray[t].x+l>=r&&gl_Cursorarray[t].channel==gl_Selected_Channel)return;for(t=gl_Selected_Cursor+1;t<gl_Cursorarray.length;t++)if(gl_Cursorarray[t].x+l<=r&&gl_Cursorarray[t].channel==gl_Selected_Channel)return}gl_Mousemove.x=r,gl_Mousemove.y=n;for(t=0;t<gl_Cursorarray.length;t++)if(gl_Mousemove.x<=gl_Cursorarray[t].x+l+3&&gl_Mousemove.x>=gl_Cursorarray[t].x+l-3&&gl_Mousemove.y<=415-4*gl_Cursorarray[t].percent+3&&gl_Mousemove.y>=415-4*gl_Cursorarray[t].percent-3){if(0==gl_Cursorarray[t].channel&0==document.getElementById("Check0").checked){c.style.cursor="cursor";continue}if(1==gl_Cursorarray[t].channel&0==document.getElementById("Check1").checked){c.style.cursor="cursor";continue}if(2==gl_Cursorarray[t].channel&0==document.getElementById("Check2").checked){c.style.cursor="cursor";continue}if(3==gl_Cursorarray[t].channel&0==document.getElementById("Check3").checked){c.style.cursor="cursor";continue}if(4==gl_Cursorarray[t].channel&0==document.getElementById("Check4").checked){c.style.cursor="cursor";continue}if(5==gl_Cursorarray[t].channel&0==document.getElementById("Check5").checked){c.style.cursor="cursor";continue}return void(c.style.cursor="pointer")}c.style.cursor="default"}},!1),c.addEventListener("mousedown",function(e){for(var r=0;r<gl_Cursorarray.length;r++)if(gl_Mousemove.x<=gl_Cursorarray[r].x+l+3&&gl_Mousemove.x>=gl_Cursorarray[r].x+l-3&&gl_Mousemove.y<=415-4*gl_Cursorarray[r].percent+3&&gl_Mousemove.y>=415-4*gl_Cursorarray[r].percent-3){if(0==gl_Cursorarray[r].channel&0==document.getElementById("Check0").checked){c.style.cursor="cursor";continue}if(1==gl_Cursorarray[r].channel&0==document.getElementById("Check1").checked){c.style.cursor="cursor";continue}if(2==gl_Cursorarray[r].channel&0==document.getElementById("Check2").checked){c.style.cursor="cursor";continue}if(3==gl_Cursorarray[r].channel&0==document.getElementById("Check3").checked){c.style.cursor="cursor";continue}if(4==gl_Cursorarray[r].channel&0==document.getElementById("Check4").checked){c.style.cursor="cursor";continue}if(5==gl_Cursorarray[r].channel&0==document.getElementById("Check5").checked){c.style.cursor="cursor";continue}gl_Mousemove.clicked=!0,gl_Selected_Channel=gl_Cursorarray[r].channel,document.getElementById("Channel_Select").value=gl_Selected_Channel,gl_Cursor_Mouse_X_Offset=gl_Cursorarray[gl_Selected_Cursor=r].x-gl_Mousemove.x,gl_Cursor_Mouse_Y_Offset=415-4*gl_Cursorarray[gl_Selected_Cursor].percent-gl_Mousemove.y;break}},!1),c.addEventListener("mouseup",function(e){gl_Mousemove.clicked=!1},!1),gl_Day.Draw_Time(),gl_Day.Coordinationsystem()},this.Draw_Time=function(){var e=new Date;x=(60*e.getHours()+e.getMinutes())/2,u.beginPath(),u.moveTo(l+x,-5),u.lineTo(l+x,435),u.strokeStyle="#6d0019",u.stroke(),u.closePath()},this.Coordinationsystem=function(){var e;u.beginPath(),u.fillStyle="black",u.moveTo(l,o),u.lineTo(l,415),u.lineTo(770,415);for(var r=0,n=0;r<t;r+=30,n++)u.moveTo(l+r,412),u.lineTo(l+r,418),e=n%2?5:0,n<10?u.fillText("0"+n+":00",l+r-14,o+e+410):u.fillText(n+":00",l+r-14,o+e+410);for(r=0,n=100;r<a;r+=20,n-=5)u.moveTo(47,o+r),u.lineTo(53,o+r),n<10?u.fillText(n+"%",29,o+r+3):n<100?u.fillText(n+"%",24,o+r+3):u.fillText(n+"%",19,o+r+3);u.closePath(),u.strokeStyle="black",u.stroke(),u.beginPath();for(r=0,n=100;r<a;r+=20,n-=5)u.moveTo(l,o+r),u.lineTo(770,o+r);u.setLineDash([1,6]),u.strokeStyle="black",u.stroke()},this.Draw_Cursors=function(){var e=u.lineWidth;u.clearRect(0,0,c.width,c.height),this.Draw_Time(),this.Coordinationsystem(),u.setLineDash([0,0]),u.strokeStyle="black";for(var r=0;r<6;r++){u.beginPath(),u.lineWidth=gl_Selected_Channel==r?3:1,u.strokeStyle=gl_Channel_Colors[r];for(var n=0;n<gl_Cursorarray.length;n++)0==r&0==document.getElementById("Check0").checked||1==r&0==document.getElementById("Check1").checked||2==r&0==document.getElementById("Check2").checked||3==r&0==document.getElementById("Check3").checked||4==r&0==document.getElementById("Check4").checked||5==r&0==document.getElementById("Check5").checked||gl_Cursorarray[n].channel==r&&(u.lineTo(gl_Cursorarray[n].x+l,415-4*gl_Cursorarray[n].percent),u.stroke(),u.beginPath(),u.arc(gl_Cursorarray[n].x+l,415-4*gl_Cursorarray[n].percent,4,0,2*Math.PI),u.strokeStyle=n==gl_Selected_Cursor?"#4dd2ff":gl_Channel_Colors[r],u.fillStyle=n==gl_Selected_Cursor?"#4dd2ff":gl_Channel_Colors[r],u.fill(),u.stroke(),u.moveTo(gl_Cursorarray[n].x+l,415-4*gl_Cursorarray[n].percent))}List_Cursorentries_from_selected_Channel(),u.lineWidth=e},this.Add_Point=function(){var e=new Date;if(15!=Count_Entries_in_gl_Cursorarray(gl_Selected_Channel)){x=(60*e.getHours()+e.getMinutes())/2;var r=prompt(unescape("Punkt%20davor%20oder%20danach%20einf%FCgen?%20(+1%20danach,%20-1%20davor)"),"");if("-1"==r){for(var n=gl_Selected_Cursor;0<=n;n--)if(gl_Cursorarray[n].channel==gl_Selected_Channel){var t=gl_Cursorarray[n].x;break}gl_Cursorarray.splice(gl_Selected_Cursor+1-1,0,{x:t,percent:50,channel:gl_Selected_Channel})}else if("1"==r){var l=gl_Cursorarray.map(function(e){return e.channel}).indexOf(gl_Selected_Channel,gl_Selected_Cursor+1);for(n=gl_Selected_Cursor;n<gl_Cursorarray.length;n++)if(gl_Cursorarray[n].channel==gl_Selected_Channel){t=gl_Cursorarray[n].x;break}-1==l?gl_Cursorarray.splice(gl_Selected_Cursor+1+1,0,{x:t,percent:50,channel:gl_Selected_Channel}):gl_Cursorarray.splice(l,0,{x:t,percent:50,channel:gl_Selected_Channel})}}else alert(unescape("Es%20k%F6nnen%20nicht%20mehr%20als%2015%20Punkte%20pro%20Kanal%20hinzugef%FCgt%20werden"))},this.Remove_Point=function(){confirm(unescape("Ausgew%E4hlten%20Punkt%20l%F6schen%3F"))&&gl_Cursorarray.splice(gl_Selected_Cursor,1)},this.Add_Channel=function(){var e=new Date;0<Count_Entries_in_gl_Cursorarray(gl_Selected_Channel)?alert(unescape("Kanal%20"+gl_Selected_Channel+"%20wurde%20bereits%20hinzugef%FCgt")):(x=(60*e.getHours()+e.getMinutes())/2,gl_Cursorarray.push({x:x,percent:50,channel:document.getElementById("Channel_Select").value}))},this.Remove_Channel=function(){if(confirm(unescape("Kanal "+gl_Selected_Channel+"%20l%F6schen%3F")))for(var e=gl_Cursorarray.length-1;0<=e;e--)gl_Cursorarray[e].channel==gl_Selected_Channel&&gl_Cursorarray.splice(e,1)},this.X_Y=function(){u.clearRect(0,0,75,7),u.fillText("X:"+gl_Mousemove.x.toFixed(0)+" Y:"+gl_Mousemove.y.toFixed(0),0,7)},this.Get_Y_off=function(){return o},this.Get_X_off=function(){return l},this.Get_Y_max=function(){return a}}function List_Cursorentries_from_selected_Channel(){for(var e='<table style="borders:none;">',r=0,n=0;r<gl_Cursorarray.length;r++)gl_Cursorarray[r].channel==gl_Selected_Channel&&(e+=gl_Selected_Cursor==r?'<tr style="background-color:'+gl_Channel_Colors[gl_Selected_Channel]+';color:white;"><td>'+n.toString()+":</td><td>"+Minutes_in_Timestamp(2*gl_Cursorarray[r].x)+"</td><td>"+gl_Cursorarray[r].percent.toFixed(2)+"%</td></tr>":"<tr><td>"+n.toString()+":</td><td>"+Minutes_in_Timestamp(2*gl_Cursorarray[r].x)+"</td><td>"+gl_Cursorarray[r].percent.toFixed(2)+"%</td></tr>",n++);e+="</table>",document.getElementById("ChannelCursorList").innerHTML=e}function Channel_Change(){gl_Selected_Channel=document.getElementById("Channel_Select").value,gl_Selected_Cursor=gl_Cursorarray.map(function(e){return e.channel}).indexOf(gl_Selected_Channel)}function Channel_Add(){gl_Day.Add_Channel()}function Channel_Remove(){gl_Day.Remove_Channel()}function Point_Add(){gl_Day.Add_Point()}function Point_Remove(){gl_Day.Remove_Point()}function Set_Day_in_Dropdown(){var e=(new Date).getDay();document.getElementById("Day").value=[6,0,1,2,3,4,5][e]}function Minutes_in_Timestamp(e){var r,n;return 0==e?"00:00":(n=(r=Math.floor(e/60))<10?"0"+r+":":r+":",n+=(e=(e-=60*r).toFixed(0))<10?"0"+e:e)}function Count_Entries_in_gl_Cursorarray(e){for(var r=0,n=0;n<gl_Cursorarray.length;n++)gl_Cursorarray[n].channel==e&&r++;return r}function Animationloop(){window.requestAnimationFrame(Animationloop),gl_Day.Draw_Cursors(),1==gl_Mousemove.clicked&&(gl_Cursorarray[gl_Selected_Cursor].x=gl_Cursor_Mouse_X_Offset+gl_Mousemove.x,gl_Cursorarray[gl_Selected_Cursor].percent=(gl_Day.Get_Y_max()+gl_Day.Get_Y_off())/4-(gl_Mousemove.y+gl_Cursor_Mouse_Y_Offset)/4,console.log(gl_Cursor_Mouse_Y_Offset))}